# Stack VM

## Overview

Stack VM is a custom virtual machine implemented in Go, designed to provide a flexible and extensible stack-based execution environment. The project includes a custom assembler, virtual machine, and supporting components for a low-level programming language.

## Features

### Assembler
- Supports parsing and compiling a custom assembly-like language
- Handles structs, functions, and various instruction types
- Generates bytecode for the virtual machine

### Virtual Machine
- Stack-based execution model
- Supports multiple value types:
  - Integer (32-bit)
  - Float (32-bit)
  - Pointers
  - Strings
  - Arrays
  - Structs

### Key Components
- Lexer: Tokenizes input source code
- Parser: Converts tokens into an abstract syntax tree
- Code Generator: Translates parsed code into bytecode
- VM: Executes the generated bytecode

## Supported Instructions

### Arithmetic
- Integer operations: `iadd`, `isub`, `imul`, `idiv`
- Float operations: `fadd`, `fsub`, `fmul`, `fdiv`

### Stack Manipulation
- `push`, `pop`, `dup`
- `store`, `load`

### Memory Management
- `alloc`, `free`
- `loadh`, `storeh`

### Control Flow
- `jmp`, `call`, `ret`
- Conditional jumps: `ije`, `ijne`, `fje`, `fjne`

### Comparison
- `eq`, `ne`, `lt`, `le`, `gt`, `ge`

### Advanced Types
- Array operations: `newarr`, `ldelem`, `stelem`
- Struct operations: `newstruct`, `fldget`, `stfield`

## Example

```
.structs
struct Point {
    x: int32
    y: int32
}

.text
func main() -> void {
    push int32 10
    push int32 20
    iadd
    ret
}
```

## Building

```bash
go mod tidy
go build
```

## Running Tests

```bash
go test ./...
```

## Project Structure

- `assembler/`: Lexer, parser, and code generation logic
- `vm/`: Virtual machine implementation
- `heap/`: Memory management
- `common/`: Shared types and utilities

## Requirements

- Go 1.22 or later

## Limitations

- Currently supports a subset of planned features
- Experimental and under active development

## License

[Specify your license here]

## Contributing

Contributions are welcome! Please feel free to submit a Pull Request.
